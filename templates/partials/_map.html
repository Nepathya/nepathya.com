{% load staticfiles %}

<script type="text/javascript" src='http://maps.google.com/maps/api/js?libraries=places'></script>

<div id="map-container" style="width: 100%; height: 400px;">

</div>

<script>
    function init_map() {
        var position = new google.maps.LatLng({{ latitude }}, {{ longitude }});

        var map = new google.maps.Map(document.getElementById("map-container"), {
            zoom: 13,
            center: position,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        });
        var icon = '{% static 'img/map/default_marker.png' %}';
        var marker = new google.maps.Marker({
            map: map,
            position: position,
            icon: icon
        });
        {% if infowindow_content %}
            var content = '{{ infowindow_content|safe }}';
            var info_window = new google.maps.InfoWindow({
                content: content
            });
            var closed = false;
            info_window.open(map, marker);
            google.maps.event.addListener(info_window, 'closeclick', function () {
                closed = true;
            });
            google.maps.event.addListener(marker, 'mouseover', function () {
                info_window.open(map, marker);
            });
            google.maps.event.addListener(marker, 'mouseout', function () {
                if (closed) {
                    info_window.close(map, marker);
                }
            });
            google.maps.event.addListener(marker, 'click', function () {
                if (closed) {
                    info_window.open(map, marker);
                    closed = false;
                }
            });

        {% endif %}
    }
    google.maps.event.addDomListener(window, 'load', init_map);

</script>